---
import { getCollection } from "astro:content";
import Layout from "../layout/Layout.astro";
import BlogCard from "../components/Blog/BlogCard.astro";
import BlogCategories from "../components/blog/BlogCategories.astro";
import BlogSearch from "../components/blog/BlogSearch.astro";
import NewsLetter from "../components/Index/NewsLetter.astro";
import "../css/blog-cards.css";

// Get all blog posts, sorted by date (newest first)
const allBlogs = await getCollection("blogs");
const sortedBlogs = allBlogs.sort((a, b) => {
  const dateA = new Date(a.data.date);
  const dateB = new Date(b.data.date);
  return dateB.getTime() - dateA.getTime();
});

// Get featured posts
const featuredBlogs = sortedBlogs.filter(blog => blog.data.featured);
const regularBlogs = sortedBlogs.filter(blog => !blog.data.featured);

// Extract unique categories for filter and format for BlogCategories component
const uniqueCategories = [...new Set(allBlogs.map(blog => blog.data.category))];
const allCategories = [
  { name: 'All Articles', slug: 'all' },
  ...uniqueCategories.map(cat => ({
    name: cat,
    slug: cat.toLowerCase().replace(/\s+/g, '-'),
    count: allBlogs.filter(blog => blog.data.category === cat).length
  }))
];

// SEO metadata - Using approved copy from MASTER-copy.md
const pageTitle = "Finance Insights Blog | Expert Business Finance Insights | Edgeview Finance";
const pageDescription = "Get insider finance knowledge from Queensland's specialist broker. 20+ years banking experience, proven strategies for businesses.";
---

<Layout 
  title={pageTitle} 
  description={pageDescription}
  canonicalURL="https://edgeviewfinance.com.au/blog"
>
  <main class='main-wrapper relative overflow-hidden'>
    <!-- Blog Hero Section - White Background Like Homepage -->
  <section class='section-hero'>
    <div class='relative z-10 overflow-hidden'>
      <div class='pt-[10px] sm:pt-[15px] lg:pt-[20px] pb-8 lg:pb-12'>
        <div class='container-default relative z-10'>
          <div class='text-center'>
            <!-- Main Headline from approved copy -->
            <h1 class='mb-6 font-InstrumentSans text-3xl sm:text-4xl lg:text-[48px] font-bold leading-[1.2] text-ColorBlack'>
              How Are Australian Businesses Really Getting Approved for Finance?
            </h1>
            
            <!-- Subheadline from approved copy -->
            <h2 class='mb-6 text-xl lg:text-2xl font-semibold text-gray-700 font-InstrumentSans'>
              Get the insider knowledge that helps Australian businesses make smarter finance decisions
            </h2>
            
            <!-- Value Proposition from approved copy -->
            <p class='mb-6 text-lg text-gray-600 font-InstrumentSans leading-relaxed max-w-4xl mx-auto'>
              20+ years of banking experience reveals what really works for businesses in finance applications. 
              No generic advice. No sales pressure. Just proven strategies from 100+ successful deals.
            </p>
            
            <!-- Trust Indicator from approved copy -->
            <div class='mb-8 flex justify-center'>
              <div class='inline-flex items-center gap-2 bg-[#f97316] bg-opacity-10 px-4 py-2'>
                <svg class='w-5 h-5 text-[#f97316]' fill='none' stroke='currentColor' viewBox='0 0 24 24'>
                  <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z'></path>
                </svg>
                <span class='text-sm font-semibold text-[#1C2C3B] font-InstrumentSans'>
                  20+ Years Banking Experience • 100+ Businesses Funded • Residential & Commercial Finance
                </span>
              </div>
            </div>
            
            <!-- Primary CTA from approved copy -->
            <div class='flex flex-col items-center'>
              <button
                id='newsletter-toggle-btn'
                class='bg-[#FF9E10] text-white px-8 py-4 font-bold transition-all duration-300 inline-block hover:bg-[#E68900] hover:shadow-lg mb-3 cursor-pointer'
              >
                Sign Up To Our Newsletter
              </button>
            </div>
            
            <!-- Hidden Newsletter Form -->
            <div id='newsletter-form-section' class='hidden mt-8 max-w-xl mx-auto'>
              <div class='p-8 bg-gray-50 border border-gray-200'>
                <h3 class='font-bold text-2xl mb-3 text-[#1C2C3B] text-center font-InstrumentSans'>
                  Get More Finance Insider Insights
                </h3>
                <p class='text-base mb-6 text-gray-600 text-center font-InstrumentSans'>
                  Join hundreds of business owners getting weekly finance strategies delivered to their inbox
                </p>
                <form class='space-y-4'>
                  <input 
                    type='email' 
                    placeholder='Enter your email address'
                    class='w-full px-4 py-3 border border-gray-300 text-base focus:outline-none focus:border-[#f97316] transition-colors font-InstrumentSans'
                    required
                  />
                  <button 
                    type='submit'
                    class='w-full bg-white text-[#f97316] px-6 py-3 text-base font-semibold border-2 border-[#f97316] hover:bg-[#f97316] hover:text-white transition-colors font-InstrumentSans'
                  >
                    Get Finance Insider Insights
                  </button>
                </form>
                <div class='mt-6 flex justify-center gap-6 text-sm text-gray-500 font-InstrumentSans'>
                  <span class='flex items-center gap-1'>
                    <svg class='w-4 h-4 text-green-500' fill='none' stroke='currentColor' viewBox='0 0 24 24'>
                      <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M5 13l4 4L19 7'></path>
                    </svg>
                    No spam, ever
                  </span>
                  <span class='flex items-center gap-1'>
                    <svg class='w-4 h-4 text-green-500' fill='none' stroke='currentColor' viewBox='0 0 24 24'>
                      <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M5 13l4 4L19 7'></path>
                    </svg>
                    Unsubscribe anytime
                  </span>
                  <span class='flex items-center gap-1'>
                    <svg class='w-4 h-4 text-green-500' fill='none' stroke='currentColor' viewBox='0 0 24 24'>
                      <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M5 13l4 4L19 7'></path>
                    </svg>
                    Trades focused
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Search and Filter Section -->
  <section class='py-12 bg-white border-b border-gray-200'>
    <div class='container-default'>
      <div class='flex flex-col lg:flex-row gap-6 items-center justify-between'>
        <!-- Search Component -->
        <div class='w-full lg:min-w-[400px] lg:flex-1 lg:max-w-lg'>
          <BlogSearch />
        </div>
        
        <!-- Categories Filter -->
        <div class='w-full lg:w-auto flex-shrink-0'>
          <BlogCategories categories={allCategories} />
        </div>
      </div>
    </div>
  </section>

  <!-- Featured Articles Section -->
  {featuredBlogs.length > 0 && (
    <section class='py-12 bg-ColorOffWhite'>
      <div class='container-default'>
        <div class='mb-16 text-center'>
          <h2 class='mb-6 font-InstrumentSans text-3xl lg:text-4xl font-bold leading-[1.2] text-ColorBlack'>
            Latest Finance Insights
          </h2>
          <p class='text-gray-600 text-lg lg:text-xl font-InstrumentSans leading-relaxed max-w-3xl mx-auto'>
            Banking insider knowledge that's helping businesses get approved faster, secure better terms and understanding the banking and finance landscape.
          </p>
        </div>
        
        <div class='grid grid-cols-1 lg:grid-cols-2 gap-6'>
          {featuredBlogs.slice(0, 2).map(blog => (
            <BlogCard 
              post={blog} 
              variant="featured"
            />
          ))}
        </div>
      </div>
    </section>
  )}

  <!-- All Articles Section -->
  <section class='py-12 bg-white'>
    <div class='container-default'>
      <div class='mb-16 text-center'>
        <h2 class='all-articles-heading mb-6 font-InstrumentSans text-3xl lg:text-4xl font-bold leading-[1.2] text-ColorBlack'>
          All Articles
        </h2>
        <p class='all-articles-subheading text-gray-600 text-lg lg:text-xl font-InstrumentSans leading-relaxed max-w-3xl mx-auto'>
          Weekly insights on business finance, equipment purchases, property investment, and cash flow optimisation.
        </p>
      </div>
      
      <!-- Articles Grid -->
      <div id='articles-container' class='grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6'>
        {regularBlogs.map(blog => (
          <BlogCard post={blog} />
        ))}
        
        {/* Show remaining featured posts if any */}
        {featuredBlogs.slice(2).map(blog => (
          <BlogCard post={blog} />
        ))}
      </div>
      
      <!-- Load More Button (for future pagination) -->
      <div class='text-center mt-16'>
        <button 
          id='load-more-btn'
          class='bg-[#FF9E10] text-white px-8 py-4 font-bold font-InstrumentSans transition-all duration-300 hover:bg-[#e8890e] hover:shadow-lg hidden'
        >
          Load More Articles
        </button>
      </div>
    </div>
  </section>

  <!-- Trust Section -->
  <section class='py-16 bg-ColorOffWhite'>
    <div class='container-default text-center'>
      <h3 class='text-2xl font-bold font-InstrumentSans mb-6 text-ColorBlack'>
        Trusted by Queensland Businesses
      </h3>
      <div class='flex flex-wrap justify-center items-center gap-8 text-sm text-gray-600'>
        <div class='flex items-center gap-2'>
          <svg class='w-5 h-5 text-[#f97316]' fill='none' stroke='currentColor' viewBox='0 0 24 24'>
            <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z'></path>
          </svg>
          <span class='font-InstrumentSans'>Australian Credit License 459287</span>
        </div>
        <div class='flex items-center gap-2'>
          <svg class='w-5 h-5 text-[#f97316]' fill='none' stroke='currentColor' viewBox='0 0 24 24'>
            <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z'></path>
          </svg>
          <span class='font-InstrumentSans'>20+ Years Banking Experience</span>
        </div>
        <div class='flex items-center gap-2'>
          <svg class='w-5 h-5 text-[#f97316]' fill='none' stroke='currentColor' viewBox='0 0 24 24'>
            <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z'></path>
          </svg>
          <span class='font-InstrumentSans'>100+ Businesses Helped</span>
        </div>
        <div class='flex items-center gap-2'>
          <svg class='w-5 h-5 text-[#f97316]' fill='none' stroke='currentColor' viewBox='0 0 24 24'>
            <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z'></path>
            <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M15 11a3 3 0 11-6 0 3 3 0 016 0z'></path>
          </svg>
          <span class='font-InstrumentSans'>Queensland Based</span>
        </div>
      </div>
    </div>
  </section>
  </main>

  <!-- Newsletter CTA Section - Inside Layout, before Footer -->
  <NewsLetter />
</Layout>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Newsletter toggle functionality
    const newsletterToggleBtn = document.getElementById('newsletter-toggle-btn');
    const newsletterFormSection = document.getElementById('newsletter-form-section');
    
    if (newsletterToggleBtn && newsletterFormSection) {
      newsletterToggleBtn.addEventListener('click', function() {
        if (newsletterFormSection.classList.contains('hidden')) {
          // Show the form with smooth animation
          newsletterFormSection.classList.remove('hidden');
          newsletterFormSection.style.opacity = '0';
          newsletterFormSection.style.transform = 'translateY(-20px)';
          
          // Force browser to process the initial state
          newsletterFormSection.offsetHeight;
          
          // Add transition and fade in
          newsletterFormSection.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
          newsletterFormSection.style.opacity = '1';
          newsletterFormSection.style.transform = 'translateY(0)';
          
          // Scroll to form smoothly
          newsletterFormSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
          
          // Focus the email input
          const emailInput = newsletterFormSection.querySelector('input[type="email"]');
          if (emailInput) {
            setTimeout(() => emailInput.focus(), 300);
          }
          
          // Change button text
          this.textContent = 'Hide Newsletter Form';
        } else {
          // Hide the form
          newsletterFormSection.style.opacity = '0';
          newsletterFormSection.style.transform = 'translateY(-20px)';
          
          setTimeout(() => {
            newsletterFormSection.classList.add('hidden');
            newsletterFormSection.style.transition = '';
            newsletterFormSection.style.opacity = '';
            newsletterFormSection.style.transform = '';
          }, 300);
          
          // Change button text back
          this.textContent = 'Sign Up To Our Newsletter';
        }
      });
    }
    
    // Category filtering functionality
    const categoryButtons = document.querySelectorAll('.category-btn');
    const articleContainer = document.getElementById('articles-container');
    const articles = articleContainer?.querySelectorAll('[data-category]');
    
    if (categoryButtons.length > 0 && articles) {
      categoryButtons.forEach(button => {
        button.addEventListener('click', function() {
          const category = this.getAttribute('data-category');
          
          // Update active state
          categoryButtons.forEach(btn => btn.classList.remove('active'));
          this.classList.add('active');
          
          // Filter articles
          articles.forEach(article => {
            const articleCategory = article.getAttribute('data-category');
            
            if (category === 'all' || articleCategory === category) {
              article.style.display = 'block';
            } else {
              article.style.display = 'none';
            }
          });
        });
      });
    }
    
    // Search functionality integration
    const searchInput = document.getElementById('blog-search');
    if (searchInput && articles) {
      searchInput.addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase().trim();
        
        if (searchTerm.length === 0) {
          // Show all articles
          articles.forEach(article => {
            article.style.display = 'block';
          });
          return;
        }
        
        // Filter articles based on search term
        articles.forEach(article => {
          const title = article.querySelector('h3')?.textContent?.toLowerCase() || '';
          const description = article.querySelector('.description')?.textContent?.toLowerCase() || '';
          const category = article.getAttribute('data-category')?.toLowerCase() || '';
          
          if (title.includes(searchTerm) || description.includes(searchTerm) || category.includes(searchTerm)) {
            article.style.display = 'block';
          } else {
            article.style.display = 'none';
          }
        });
      });
    }
  });
</script>

<style>
  /* Blog page design system matching homepage */
  .section-hero {
    background: white;
  }
  
  /* Sticky search bar */
  .search-filter {
    position: sticky;
    top: 0;
    z-index: 10;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
  }
  
  /* Article filtering animations */
  #articles-container [data-category] {
    transition: opacity 0.3s ease, transform 0.3s ease;
  }
  
  /* Remove local container-default override to use global styles */
  
  /* Grid responsiveness matching Agency11 */
  @media (max-width: 768px) {
    .grid-cols-1.md\:grid-cols-2.lg\:grid-cols-3 {
      grid-template-columns: 1fr;
      gap: 2rem;
    }
  }
  
  @media (min-width: 769px) and (max-width: 991px) {
    .grid-cols-1.md\:grid-cols-2.lg\:grid-cols-3 {
      grid-template-columns: repeat(2, 1fr);
      gap: 2.5rem;
    }
  }
  
  @media (min-width: 992px) {
    .grid-cols-1.md\:grid-cols-2.lg\:grid-cols-3 {
      grid-template-columns: repeat(3, 1fr);
      gap: 2.5rem;
    }
  }
</style>