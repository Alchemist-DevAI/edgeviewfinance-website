---
// CSS Import Order - Optimized Cascade Hierarchy
// 1. External Dependencies (Foundation)
import "jos-animation/dist/jos.css";
// Instrument Sans fonts now self-hosted in /public/fonts/ - no network latency
// FontAwesome removed - not used on homepage, loaded on-demand by other pages

// 2. Framework Base Layer
import "../css/tailwind.css";

// 3. Design Token Layer
import "../css/variables.css";

// 3.5. Font Optimization Layer (for performance)
import "../css/font-optimization.css";

// 4. Utility Layer
import "../css/typography-utilities.css";

// 5. Component Layer
import "../css/menu.css";
import "../css/custom.css";

// 6. Override Layer (most specific last)
import "../css/global-overrides.css";
import "../css/page-specific-overrides.css";
import "../css/hero-section.css";

// 7. Component Imports
import Header from "../components/ui/Header.astro";
import Footer from "../components/ui/Footer.astro";
import GoogleAnalytics from "../components/analytics/GoogleAnalytics.astro";
import MicrosoftClarity from "../components/analytics/MicrosoftClarity.astro";
import SpeedInsights from "@vercel/speed-insights/astro";
import { getEntry } from "astro:content";
const { title, description: pageDescription } = Astro.props;
const MetaData = await getEntry({ collection: "site", id: "meta" });
const { siteName, description: siteDescription, favicon } = MetaData?.data;
const description = pageDescription || siteDescription;
---

<!doctype html>
<html lang='en'>
  <head>
    <meta charset='UTF-8' />
    <meta name='viewport' content='width=device-width, initial-scale=1.0' />
    <title>{siteName}{" "} | {" "}{title}</title>
    <meta
      name='description'
      content={description ? description : "Agency11 Theme"}
    />

    <!-- Preload critical self-hosted fonts for instant availability -->
    <link rel="preload" href="/fonts/instrument-sans-latin-400-normal.woff2" as="font" type="font/woff2" crossorigin />
    <link rel="preload" href="/fonts/instrument-sans-latin-700-normal.woff2" as="font" type="font/woff2" crossorigin />

    <!-- Preconnect to external domains for performance -->
    <link rel="preconnect" href="https://assets.calendly.com" crossorigin />
    <link rel="dns-prefetch" href="https://www.googletagmanager.com" />
    <link rel="dns-prefetch" href="https://www.clarity.ms" />

    <!-- Favicon Support for All Browsers -->
    <link rel='icon' type='image/x-icon' href='/favicon.ico' />
    <link rel='icon' type='image/png' sizes='16x16' href='/favicon.png' />
    <link rel='icon' type='image/png' sizes='32x32' href='/favicon.png' />
    <link rel='icon' type='image/png' sizes='192x192' href='/android-chrome-192x192.png' />
    <link rel='icon' type='image/png' sizes='512x512' href='/android-chrome-512x512.png' />
    <link rel='apple-touch-icon' sizes='180x180' href='/apple-touch-icon.png' />
    <link rel='icon' type='image/webp' href={favicon || "/favicon.webp"} />
    <link rel='manifest' href='/site.webmanifest' />

    <!-- International Targeting for Australia -->
    <link rel="alternate" hreflang="en-au" href={Astro.url.href} />
    <link rel="alternate" hreflang="en" href={Astro.url.href} />
    <link rel="alternate" hreflang="x-default" href={Astro.url.href} />

    <!-- Open Graph Meta Tags -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content={`${siteName} | ${title}`} />
    <meta property="og:description" content={description || "Professional business advisory services in Australia"} />
    <meta property="og:url" content={Astro.url.href} />
    <meta property="og:site_name" content={siteName} />
    <meta property="og:locale" content="en_AU" />
    <meta property="og:image" content={`${Astro.site}assets/img/edgeview-finance-og-image.jpg`} />

    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={`${siteName} | ${title}`} />
    <meta name="twitter:description" content={description || "Professional business advisory services in Australia"} />
    <meta name="twitter:image" content={`${Astro.site}assets/img/edgeview-finance-og-image.jpg`} />

    <!-- Geographic Targeting -->
    <meta name="geo.region" content="AU" />
    <meta name="geo.country" content="Australia" />
    <meta name="geo.placename" content="Australia" />

    <!-- Canonical URL -->
    <link rel="canonical" href={Astro.url.href} />

    <!-- Responsive hero image preloading for LCP optimization -->
    {Astro.url.pathname === '/' && (
      <>
        <link rel='preload' as='image' href='/assets/images/hero-tradie-mobile.webp' fetchpriority='high' media='(max-width: 640px)' />
        <link rel='preload' as='image' href='/assets/images/hero-tradie-final.webp' fetchpriority='high' media='(min-width: 641px)' />
      </>
    )}
    <!-- Equipment Finance and Vehicle Finance pages have text-only heroes - no image preload needed -->

    <!-- Critical CSS inlined for LCP - Expanded for complete above-the-fold rendering -->
    <style>
      /* Font Family */
      body,.font-InstrumentSans{font-family:'Instrument Sans',system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;font-size-adjust:0.5}

      /* Hero Section Container */
      .section-hero{background-color:#FDFBF9;padding-top:1rem;padding-bottom:3rem}
      @media (min-width:768px){.section-hero{padding-top:1.5rem;padding-bottom:4rem}}
      @media (min-width:1024px){.section-hero{padding-top:2rem;padding-bottom:5rem}}

      /* Container */
      .container-default{width:100%;max-width:1200px;margin:0 auto;padding:0 1rem}
      @media (min-width:1024px){.container-default{padding:0 2rem}}

      /* Grid Layout */
      .grid{display:grid}.grid-cols-1{grid-template-columns:repeat(1,minmax(0,1fr))}.gap-8{gap:2rem}
      @media (min-width:1024px){.lg\:grid-cols-5{grid-template-columns:repeat(5,minmax(0,1fr))}.lg\:col-span-3{grid-column:span 3/span 3}.lg\:col-span-2{grid-column:span 2/span 2}.lg\:gap-12{gap:3rem}}

      /* Hero Typography */
      .section-hero h1{font-size:2.25rem;font-weight:700;letter-spacing:-0.02em;line-height:1.1;margin-bottom:1rem;color:#1f2937}
      @media (min-width:640px){.section-hero h1{font-size:2.5rem}}
      @media (min-width:768px){.section-hero h1{font-size:2.75rem}}
      @media (min-width:1024px){.section-hero h1{font-size:3rem}}

      .section-hero h2{font-size:1.25rem;font-weight:500;color:#4B5563;line-height:1.4;margin-bottom:1.5rem}
      @media (min-width:640px){.section-hero h2{font-size:1.375rem}}
      @media (min-width:1024px){.section-hero h2{font-size:1.5rem}}

      .section-hero p{font-size:0.875rem;line-height:1.6;font-weight:400;color:#4B5563}
      @media (min-width:640px){.section-hero p{font-size:0.9375rem}}
      @media (min-width:1024px){.section-hero p{font-size:1rem}}

      /* CTA Button */
      .bg-\[#f97316\]{background-color:#f97316;color:#ffffff;font-weight:500;padding:0.875rem 2rem;border-radius:0.375rem;display:inline-block;transition:background-color 0.2s}
      .bg-\[#f97316\]:hover{background-color:#ea580c}
      @media (min-width:1024px){.section-hero a.bg-\[\\#f97316\\]{font-size:1.125rem}}

      /* Trust Badge */
      .inline-flex{display:inline-flex;align-items:center;gap:0.5rem}
      .section-hero .inline-flex span{font-size:0.875rem;font-weight:600}

      /* Utility Classes */
      .relative{position:relative}.z-10{z-index:10}.w-full{width:100%}.h-auto{height:auto}.mb-6{margin-bottom:1.5rem}.text-white{color:#ffffff}.font-bold{font-weight:700}

      /* Image Optimization */
      img{max-width:100%;height:auto;display:block}
    </style>

    <!-- Force mobile menu submenu styling -->
    <link rel='stylesheet' href='/assets/css/mobile-menu-fix.css' />
    <!-- Calendly widget styling - deferred for performance -->
    <link href="https://assets.calendly.com/assets/external/widget.css" rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <noscript><link href="https://assets.calendly.com/assets/external/widget.css" rel="stylesheet"></noscript>
    <!-- Google Analytics GA4 - Optimized Component -->
    <GoogleAnalytics />
    <!-- Microsoft Clarity - Heatmaps and Session Recording -->
    <MicrosoftClarity />
  </head>
  <body>
    <div class=`page-wrapper relative z-[1] ${Astro.url.pathname==='/'?'bg-[#FDFBF9]':'bg-white'}`>
      <Header />
      <slot />
      <Footer />
    </div>
    <!-- Vercel Speed Insights - Real User Monitoring -->
    <SpeedInsights />
  </body>
</html>

<!-- Critical menu script - must load early for mobile menu functionality -->
<script src='/assets/js/menu.js' is:inline></script>
<!-- Non-critical scripts - deferred for LCP optimization -->
<script src='/assets/js/countdown.js' is:inline defer></script>
<script src='/assets/js/counterup.js' is:inline defer></script>
<script src='/assets/js/main.js' is:inline defer></script>
<!-- Calendly widget script - fully async, non-blocking -->
<script src="https://assets.calendly.com/assets/external/widget.js" type="text/javascript" async></script>
<!-- Analytics Initialization - fully async, non-blocking -->
<script type="module" src="/src/scripts/analytics-init.js" async></script>
<!-- Service Worker Registration - Deferred to idle time for LCP optimization -->
<script async>
  // Register service worker for offline functionality (deferred to idle time)
  if ('serviceWorker' in navigator) {
    // Defer to idle time to avoid blocking main thread during page load
    const registerServiceWorker = () => {
      navigator.serviceWorker.register('/sw.js', {
        scope: '/'
      })
      .then(registration => {
        // Service worker registered successfully

        // Check for updates
        registration.addEventListener('updatefound', () => {
          const newWorker = registration.installing;
          if (newWorker) {
            newWorker.addEventListener('statechange', () => {
              if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                // New service worker available
                // Optionally show update notification to user
              }
            });
          }
        });
      })
      .catch(error => {
        // Service worker registration failed - silently fail
      });
    };

    // Use requestIdleCallback for better performance, fallback to setTimeout
    if ('requestIdleCallback' in window) {
      requestIdleCallback(registerServiceWorker, { timeout: 2000 });
    } else {
      setTimeout(registerServiceWorker, 2000);
    }

    // Listen for service worker messages
    navigator.serviceWorker.addEventListener('message', event => {
      if (event.data && event.data.type === 'CACHE_UPDATED') {
        // Cache updated
      }
    });

    // Handle online/offline status
    function updateOnlineStatus() {
      const status = navigator.onLine ? 'online' : 'offline';
      document.body.setAttribute('data-connection', status);
    }

    window.addEventListener('online', updateOnlineStatus);
    window.addEventListener('offline', updateOnlineStatus);
    updateOnlineStatus(); // Initial status
  }
</script>
<!-- JOS animations disabled for static display -->
<!-- <script>
  import JOS from "jos-animation";
  JOS.init({
    passive: false,
    once: true,
    animation: "fade-up",
    timingFunction: "ease",
    threshold: 0,
    delay: 0.5,
    duration: 0.7,
    scrollDirection: "down",
    rootMargin: "0% 0% 15% 0%",
  });
</script> -->
