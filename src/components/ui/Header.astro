---
import { getEntry } from "astro:content";
import Logo from "./Logo.astro";
import Navigation from "./Navigation.astro";
const {
  data: { rightButton1, rightButton2 },
} = await getEntry({ collection: "site", id: "header" });
---

<header
  class='site-header site-header--absolute is--white py-3'
  id='sticky-menu'>
  <div class='container-default'>
    <div class='flex items-center justify-between gap-x-4 md:gap-x-8'>
      <Logo link='/' />
      <div class='menu-block-wrapper flex-1 hidden lg:flex'>
        <div class='menu-overlay'></div>
        <nav class='menu-block' id='append-menu-header'>
          <Navigation />
        </nav>
      </div>
      <div class='flex items-center gap-3 md:gap-6'>
        <a
          href={rightButton1?.link || 'tel:1300280895'}
          class='btn-text hidden hover:text-ColorLime md:inline-flex flex-col items-center leading-tight text-center'
        >
          <span class='text-xs'>Discuss a Scenario</span>
          <span class='text-sm'>Call 1300 280 895</span>
        </a>
        <button
          onclick="Calendly.initPopupWidget({url: 'https://calendly.com/dan-peters-edgeviewfinance/finance-discovery-call'});return false;"
          class='header-cta-btn inline-flex items-center justify-center border-2 px-3 py-2 md:px-6 md:py-3 font-semibold transition-all duration-300 hidden sm:inline-block text-sm md:text-base cursor-pointer'
          ><span>{rightButton2?.text || 'Book Discovery Call'}</span></button
        >
        <div class='block lg:hidden'>
          <button
            id='openBtn'
            class='hamburger-menu mobile-menu-trigger'
            aria-label='Open Menu'
            aria-expanded='false'
            aria-controls='mobile-menu'>
            <span></span>
            <span></span>
            <span></span>
            <span class="sr-only">Open navigation menu</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Mobile Menu Overlay -->
  <div class='menu-overlay'></div>

  <!-- Mobile Menu -->
  <nav class='mobile-menu-block' id='mobile-menu'>
    <div class='mobile-menu-head'>
      <div class='go-back'>
        <i class='fa-solid fa-angle-left'></i>
      </div>
      <div class='current-menu-title'>Menu</div>
      <button class='mobile-menu-close' id='closeBtn' aria-label='Close Menu' aria-controls='mobile-menu'>
        &times;
        <span class="sr-only">Close navigation menu</span>
      </button>
    </div>
    <div class='mobile-menu-content' id='mobile-menu-content'>
      <Navigation />
      <!-- Mobile CTA Buttons -->
      <div class='mobile-cta-buttons'>
        <a
          href={rightButton1?.link || 'tel:1300280895'}
          class='mobile-cta-phone'
        >
          <span class='text-xs'>Discuss a Scenario</span>
          <span>Call 1300 280 895</span>
        </a>
        <button
          onclick="Calendly.initPopupWidget({url: 'https://calendly.com/dan-peters-edgeviewfinance/finance-discovery-call'});return false;"
          class='mobile-cta-button'
        >
          {rightButton2?.text || 'Book Discovery Call'}
        </button>
      </div>
    </div>
  </nav>
</header>

<style>
  /* Make header sticky */
  :global(.site-header) {
    position: fixed !important;
    top: 0;
    width: 100%;
    z-index: 9999;
    background: rgba(255, 255, 255, 0.98);
    backdrop-filter: blur(10px);
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
  }
  
  /* Add padding to compensate for fixed header */
  :global(.main-wrapper) {
    padding-top: 80px;
  }
  
  /* Brand Button Styling */
  .btn-primary {
    border-radius: 0 !important;
    border: 2px solid #f97316 !important;
    transition: all 0.3s ease !important;
  }
  
  .btn-primary:hover {
    box-shadow: 0 4px 12px rgba(249, 115, 22, 0.3) !important;
  }

  /* Header CTA Button - following CSS refactoring guidelines */
  .header-cta-btn {
    background-color: transparent !important;
    color: #f97316 !important;
    border-color: #f97316 !important;
    border-radius: 0 !important;
    font-family: "Instrument Sans", sans-serif !important;
  }

  .header-cta-btn:hover {
    background-color: #f97316 !important;
    color: white !important;
    border-color: #f97316 !important;
  }
  
  /* Navigation hover effects */
  :global(.nav-link-item) {
    transition: color 0.3s ease !important;
  }
  
  :global(.nav-link-item:hover) {
    color: #FF9E10 !important;
  }

  /* Hamburger Menu Styling */
  .hamburger-menu {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    width: 24px;
    height: 18px;
    background: none;
    border: none;
    cursor: pointer;
    padding: 0;
    position: relative;
  }

  .hamburger-menu span {
    display: block;
    height: 2px;
    width: 100%;
    background-color: #1C2C3B;
    transition: all 0.3s ease;
    transform-origin: center;
  }

  .hamburger-menu.active span:nth-child(1) {
    transform: rotate(45deg) translate(5px, 5px);
  }

  .hamburger-menu.active span:nth-child(2) {
    opacity: 0;
  }

  .hamburger-menu.active span:nth-child(3) {
    transform: rotate(-45deg) translate(6px, -6px);
  }

  /* Mobile Menu Overlay */
  .menu-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 9998;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
  }

  .menu-overlay.active {
    opacity: 1;
    visibility: visible;
  }

  /* Mobile Menu Block - with high specificity to override menu.css */
  nav.mobile-menu-block {
    position: fixed !important;
    top: 0 !important;
    right: 0 !important;
    left: auto !important;
    width: 320px !important;
    max-width: 85vw !important;
    height: 100vh !important;
    background: white !important;
    z-index: 9999 !important;
    transform: translateX(100%) !important;
    transition: transform 0.3s ease !important;
    overflow-y: auto !important;
    box-shadow: -5px 0 20px rgba(0, 0, 0, 0.1) !important;
    display: block !important;
  }

  nav.mobile-menu-block.active {
    transform: translateX(0) !important;
  }

  /* Mobile Menu Head */
  .mobile-menu-head {
    display: none; /* Hide by default on desktop */
    align-items: center;
    justify-content: space-between;
    padding: 20px;
    border-bottom: 1px solid #E5E5E5;
    background: white;
    position: sticky;
    top: 0;
    z-index: 10;
  }

  /* Show mobile menu head only in mobile menu */
  nav.mobile-menu-block .mobile-menu-head {
    display: flex;
  }

  /* Hide go-back button */
  .go-back {
    display: none !important;
  }

  .mobile-menu-close {
    font-size: 24px;
    cursor: pointer;
    color: #666;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: all 0.3s ease;
    background: none;
    border: none;
    padding: 0;
  }

  .mobile-menu-close:hover {
    background: #f5f5f5;
    color: #333;
  }

  .current-menu-title {
    font-weight: 600;
    color: #1C2C3B;
    font-size: 18px;
  }

  /* Mobile Menu Content */
  .mobile-menu-content {
    padding: 20px;
  }

  /* Mobile Submenu Styling - High specificity to override Navigation.astro */
  nav.mobile-menu-block .mobile-menu-content .sub-menu {
    width: calc(100% - 20px) !important;
    margin: 10px 0 10px 20px !important;
    padding: 0 !important;
    background: #f8f9fa !important;
    position: static !important;
    box-shadow: none !important;
    border: none !important;
    border-left: 3px solid #f97316 !important;
    display: none !important;
    overflow: hidden;
    border-radius: 0 8px 8px 0 !important;
  }

  nav.mobile-menu-block .mobile-menu-content .nav-item-has-children.active > .sub-menu,
  nav.mobile-menu-block .mobile-menu-content .sub-menu.active {
    display: block !important;
  }

  .mobile-menu-content .sub-menu--item {
    padding: 0 !important;
    border-bottom: 1px solid #e9ecef !important;
    margin: 0 !important;
    list-style: none !important;
  }

  .mobile-menu-content .sub-menu--item:last-child {
    border-bottom: none !important;
  }

  .mobile-menu-content .sub-menu--item a,
  .mobile-menu-content .sub-menu--item .nav-sub-link {
    color: #4a5568 !important;
    font-size: 15px !important;
    display: block !important;
    padding: 12px 20px !important;
    transition: all 0.3s ease !important;
    text-decoration: none !important;
    white-space: normal !important;
    word-wrap: break-word !important;
  }

  .mobile-menu-content .sub-menu--item a:hover,
  .mobile-menu-content .sub-menu--item .nav-sub-link:hover {
    color: #f97316 !important;
    background: rgba(249, 115, 22, 0.05) !important;
    padding-left: 25px !important;
  }

  /* Fix nav item spacing in mobile */
  .mobile-menu-content .nav-item {
    padding: 12px 0;
    border-bottom: 1px solid #e5e5e5;
  }

  .mobile-menu-content .nav-item:last-child {
    border-bottom: none;
  }

  .mobile-menu-content .nav-link-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    color: #1C2C3B;
    font-size: 16px;
    font-weight: 500;
    text-decoration: none !important;
    transition: color 0.3s ease;
  }

  .mobile-menu-content .nav-link-item:hover {
    color: #f97316 !important;
  }

  /* Dropdown arrow styling */
  .mobile-menu-content .dropdown-arrow {
    transition: transform 0.3s ease;
    opacity: 0.6;
  }

  .mobile-menu-content .nav-item-has-children.active .dropdown-arrow {
    transform: rotate(180deg);
    opacity: 1;
  }

  /* Mobile CTA Buttons */
  .mobile-cta-buttons {
    margin-top: 30px;
    padding-top: 20px;
    border-top: 1px solid #E5E5E5;
    display: flex;
    flex-direction: column;
    gap: 15px;
  }

  .mobile-cta-phone {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 8px;
    text-decoration: none;
    color: #1C2C3B;
    border: 2px solid #e9ecef;
    transition: all 0.3s ease;
  }

  .mobile-cta-phone:hover {
    border-color: #f97316;
    background: #fff7ed;
  }

  .mobile-cta-button {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 15px 20px;
    background: #f97316;
    color: white !important;
    text-decoration: none;
    border-radius: 0;
    border: 2px solid #f97316;
    font-weight: 600;
    transition: all 0.3s ease;
    cursor: pointer;
    width: 100%;
    font-size: 16px;
    font-family: inherit;
  }

  .mobile-cta-button:hover {
    background: #ea580c;
    border-color: #ea580c;
    transform: none;
    box-shadow: 0 4px 12px rgba(249, 115, 22, 0.3);
  }

  /* Responsive adjustments */
  @media (max-width: 480px) {
    .container-default {
      padding-left: 1rem;
      padding-right: 1rem;
    }

    .mobile-menu-block {
      width: 100%;
      max-width: 100vw;
    }

    .hamburger-menu {
      width: 26px;
      height: 20px;
    }

    .hamburger-menu span {
      height: 2px;
    }
  }

  /* Hide desktop menu on mobile */
  @media (max-width: 1023px) {
    .menu-block-wrapper:not(.mobile-menu-content .menu-block-wrapper) {
      display: none !important;
    }
  }
</style>

<script>
  // Minimal script for essential functionality only
  document.addEventListener('DOMContentLoaded', () => {
    // Smooth scrolling for anchor links
    const anchorLinks = document.querySelectorAll('a[href^="#"]');
    
    anchorLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        const href = link.getAttribute('href');
        if (href && href !== '#') {
          e.preventDefault();
          const targetId = href.substring(1);
          const targetElement = document.getElementById(targetId);
          
          if (targetElement) {
            const headerHeight = 80; // Height of fixed header
            const targetPosition = targetElement.offsetTop - headerHeight;
            
            window.scrollTo({
              top: targetPosition,
              behavior: 'smooth'
            });
          }
        }
      });
    });
  });
</script>