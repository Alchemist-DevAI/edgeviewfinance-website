---
interface Props {
  title?: string;
  subtitle?: string;
  variant?: 'default' | 'compact' | 'category';
  showBenefits?: boolean;
}

const {
  title = "Don't Miss Critical Finance Updates",
  subtitle = "Get weekly insights on Australian trades finance trends, opportunities, and expert strategies delivered to your inbox",
  variant = 'default',
  showBenefits = true
} = Astro.props;

// Generate unique ID for this newsletter form instance
const formId = `newsletter-${variant}-${Math.random().toString(36).substr(2, 9)}`;

const benefits = [
  "Trades market trend analysis and predictions",
  "Application strategies that work for trades businesses", 
  "Financial management insights to improve trades cash flow",
  "Regulatory updates that affect trades businesses",
  "Exclusive trades case studies and results"
];

const trustIndicators = [
  { text: "No spam, ever", icon: "shield-check" },
  { text: "Unsubscribe anytime", icon: "zap" }, 
  { text: "Trades focused", icon: "fingerprint" }
];
---

<section 
  id="newsletter-signup"
  class={`newsletter-section text-center ${
    variant === 'compact' 
      ? 'bg-[#F8F9FA] p-8 my-8'
      : 'bg-[#FFF7ED] border-t-4 border-[#FF9E10] py-16 px-8 my-16'
  }`}
>
  <div class={`mx-auto ${variant === 'compact' ? 'max-w-md' : 'max-w-2xl'}`}>
    <!-- Headlines -->
    <div class="mb-8">
      <h2 class={`newsletter-title font-bold text-[#1C2C3B] mb-4 ${
        variant === 'compact' ? 'text-xl' : 'text-2xl lg:text-3xl'
      }`}>
        {title}
      </h2>
      
      <p class={`newsletter-subtitle text-[#374151] leading-relaxed ${
        variant === 'compact' ? 'text-sm mb-4' : 'text-lg mb-6'
      }`} id={`${formId}-description`}>
        {subtitle}
      </p>
    </div>

    <!-- Benefits List (for default variant) -->
    {showBenefits && variant === 'default' && (
      <div class="newsletter-benefits mb-8 text-left max-w-lg mx-auto">
        <p class="text-base font-medium text-[#1C2C3B] mb-4">
          Join trades business owners who get the finance intelligence that matters:
        </p>
        <ul class="space-y-2">
          {benefits.map(benefit => (
            <li class="flex items-start gap-3 text-sm text-[#374151]">
              <i class="fa-solid fa-check text-[#FF9E10] mt-0.5 flex-shrink-0" aria-hidden="true"></i>
              <span>{benefit}</span>
            </li>
          ))}
        </ul>
      </div>
    )}

    <!-- Newsletter Form -->
    <form 
      class={`newsletter-form mb-6 ${
        variant === 'compact' 
          ? 'flex flex-col gap-3' 
          : 'flex flex-col sm:flex-row gap-4 max-w-lg mx-auto'
      }`}
      action="#"
      method="POST"
    >
      <div class={`flex-1 ${variant === 'compact' ? '' : 'min-w-0'}`}>
        <label for={formId} class="sr-only">Email address for newsletter subscription</label>
        <input
          type="email"
          id={formId}
          name="email"
          required
          class="newsletter-input w-full px-4 py-3 text-base border-2 border-[#D1D5DB] bg-white text-[#374151] placeholder-[#9CA3AF] focus:border-[#1C2C3B] focus:outline-none transition-colors duration-300"
          placeholder="Enter your email address"
          aria-label="Email address for newsletter subscription"
          aria-describedby={`${formId}-description`}
        />
      </div>
      
      <button
        type="submit"
        class={`newsletter-button bg-transparent text-[#f97316] font-semibold border-2 border-[#f97316] hover:bg-[#f97316] hover:text-white focus:bg-[#f97316] focus:text-white focus:outline-none transition-all duration-300 ${
          variant === 'compact'
            ? 'px-6 py-3 text-sm'
            : 'px-8 py-3 text-base'
        }`}
      >
        Get Finance Insider Insights
      </button>
    </form>

    <!-- Trust Indicators -->
    <div class={`newsletter-trust-indicators flex justify-center items-center gap-6 text-[#6B7280] ${
      variant === 'compact' ? 'text-xs flex-wrap' : 'text-sm flex-wrap'
    }`}>
      {trustIndicators.map((indicator, index) => (
        <div class="flex items-center gap-2">
          {indicator.icon === 'shield-check' && (
            <svg class="w-4 h-4 text-[#6B7280]" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
            </svg>
          )}
          {indicator.icon === 'zap' && (
            <svg class="w-4 h-4 text-[#6B7280]" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
            </svg>
          )}
          {indicator.icon === 'fingerprint' && (
            <svg class="w-4 h-4 text-[#6B7280]" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 11c0 3.517-1.009 6.799-2.753 9.571m-3.44-2.04l.054-.09A13.916 13.916 0 008 11a4 4 0 118 0c0 1.017-.07 2.019-.203 3m-2.118 6.844A21.88 21.88 0 0015.171 17m3.839 1.132c.645-2.266.99-4.659.99-7.132A8 8 0 008 4.07M3 15.364c.64-1.319 1-2.8 1-4.364 0-1.457.39-2.823 1.07-4"></path>
            </svg>
          )}
          <span>{indicator.text}</span>
        </div>
      ))}
    </div>
  </div>
</section>

<script define:vars={{ formId }}>
  document.addEventListener('DOMContentLoaded', function() {
    const forms = document.querySelectorAll('.newsletter-form');
    
    forms.forEach(form => {
      form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const emailInput = this.querySelector(`#${formId}`) as HTMLInputElement;
        const submitButton = this.querySelector('button[type="submit"]') as HTMLButtonElement;
        
        if (!emailInput || !submitButton) return;
        
        const email = emailInput.value.trim();
        
        if (!email) {
          alert('Please enter your email address.');
          return;
        }
        
        // Simple email validation
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
          alert('Please enter a valid email address.');
          return;
        }
        
        // Disable button and show loading state
        const originalText = submitButton.textContent;
        submitButton.disabled = true;
        submitButton.textContent = 'Subscribing...';
        
        // Get the current page path for source tracking
        const currentPath = window.location.pathname;
        
        fetch('/api/newsletter-subscribe', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            email: email,
            source: currentPath
          })
        })
        .then(response => response.json())
        .then(result => {
          if (result.success) {
            alert('Thank you for subscribing! You\'ll receive your first newsletter soon.');
            emailInput.value = '';
          } else {
            alert(result.error || 'Something went wrong. Please try again.');
          }
        })
        .catch(error => {
          console.error('Newsletter subscription error:', error);
          alert('Unable to subscribe at this time. Please try again later.');
        })
        .finally(() => {
          submitButton.disabled = false;
          submitButton.textContent = originalText;
        });
      });
    });
  });
</script>

<style>
  .newsletter-section {
    /* Sharp corners - no border-radius */
  }

  .newsletter-input {
    /* Sharp corners - no border-radius */
  }

  .newsletter-button {
    /* Sharp corners - no border-radius */
  }

  @media (max-width: 640px) {
    .newsletter-form {
      @apply flex-col gap-3;
    }
    
    .newsletter-trust-indicators {
      @apply flex-col gap-2;
    }
  }
</style>