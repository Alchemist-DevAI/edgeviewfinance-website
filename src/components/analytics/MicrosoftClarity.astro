---
/**
 * Microsoft Clarity Integration Component
 * Implements heatmaps and session recording for the Edgeview Finance website
 * Project ID: tbgyvsfiaq
 */

// Only render in production or when explicitly enabled
const isProduction = import.meta.env.PROD;
const clarityEnabled = import.meta.env.PUBLIC_CLARITY_ENABLED !== 'false';
const clarityProjectId = import.meta.env.PUBLIC_CLARITY_PROJECT_ID || 'tbgyvsfiaq';

const shouldRenderClarity = isProduction && clarityEnabled;
---

{shouldRenderClarity && (
  <script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", clarityProjectId);
  </script>
)}

<script>
  // Initialize Clarity with additional configuration if needed
  if (typeof window !== 'undefined' && window.clarity) {
    // Set user properties for better segmentation
    window.clarity('set', 'page_type', document.querySelector('meta[name="page-type"]')?.content || 'general');

    // Track custom events that are relevant to Clarity
    window.clarity('set', 'user_type', 'visitor');

    // Add any custom dimensions
    const pageCategory = document.querySelector('meta[name="category"]')?.content;
    if (pageCategory) {
      window.clarity('set', 'page_category', pageCategory);
    }
  }
</script>